box: python:latest

# Build definition
build:
  # The steps that will be executed on build
  steps:
    - script:
      name: generate artefact
      code: echo "artefact" > $WERCKER_REPORT_ARTIFACTS_DIR/artefact.txt
    - pip-install

deploy:
  steps:
    - pip-install
    - internal/docker-push:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
        repository: davegri/librecrawler
        cmd: python crawl.py
        registry: https://registry.hub.docker.com
    - add-ssh-key:
        keyname: DIGITAL_OCEAN
    - add-to-known_hosts:
        hostname: $SERVER_IP
    - script:
        name: download image
        code: ssh root@$SERVER_IP docker pull davegri/librecrawler
